<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="icon" href="/images/logo.svg">
   <link rel="stylesheet" href="/component.css">
   <link rel="stylesheet" href="/style.css">
   <link rel="stylesheet" href="login.css">
   <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
   <title>Login | OcuTech</title>
   <style>
     #login-form {
       display: block !important;
       opacity: 1 !important;
       transition: opacity 0.3s ease-in;
     }
     .success-message {
       position: fixed;
       top: 50%;
       left: 50%;
       transform: translate(-50%, -50%);
       background: #4CAF50;
       color: white;
       padding: 20px;
       border-radius: 5px;
       z-index: 1000;
       animation: fadeIn 0.3s ease-in;
     }
     @keyframes fadeIn {
       from { opacity: 0; }
       to { opacity: 1; }
     }
   </style>
</head>
<body>
  <header>
    <div class="container">
      
            <div class="logo1">
                <a href="https://new.deltauniv.edu.eg/ar/home/index" target="_blank" rel="noopener noreferrer">
                  <img src="/images/logo/DT.png" alt="University">
                </a>
            </div>

            <div class="headerlogo">
              <a href="/index.html">
                
                <h1>O</h1>
                <h1>c</h1>
                <h1>u</h1>
                <img src="/images/logo.svg">
                <h1>T</h1>
                <h1>e</h1>
                <h1>c</h1>
                <h1>h</h1>
              </a>
            </div>

            <div class="uyuyu">


              <div class="sign-up">
                <div class="button"><a href="/signup/signup.html">Sign up!</a></div>
              </div>

              <div class="menu">
                <span class="menu-span top"></span>
                <span class="menu-span middle"></span>
                <span class="menu-span bottom"></span>
            </div>

            
            </div>

            <nav class="nav">
              <a href="/index.html#About_us">About us</a>
              <a href="/index.html#services">Service</a>
              <a href="/market.html">Market</a>
              <a href="/camera.html">Start Use</a>
              <a href="/market.html#Contact">Contact</a>
            </nav> 
    </div>
  </header>

  <form id="login-form">
    <div class="flex-column">
      <label>Email</label>
    </div>
    <div class="inputForm">
      <svg height="20" viewBox="0 0 32 32" width="20" xmlns="http://www.w3.org/2000/svg">
        <g id="Layer_3" data-name="Layer 3">
          <path fill="white" d="m30.853 13.87a15 15 0 0 0 -29.729 4.082 15.1 15.1 0 0 0 12.876 12.918 15.6 15.6 0 0 0 2.016.13 14.85 14.85 0 0 0 7.715-2.145 1 1 0 1 0 -1.031-1.711 13.007 13.007 0 1 1 5.458-6.529 2.149 2.149 0 0 1 -4.158-.759v-10.856a1 1 0 0 0 -2 0v1.726a8 8 0 1 0 .2 10.325 4.135 4.135 0 0 0 7.83.274 15.2 15.2 0 0 0 .823-7.455zm-14.853 8.13a6 6 0 1 1 6-6 6.006 6.006 0 0 1 -6 6z"/>
        </g>
      </svg>
      <input type="email" class="input" id="email" placeholder="Enter your Email" required>
    </div>

    <div class="flex-column">
      <label>Password</label>
    </div>
    <div class="inputForm">
      <svg height="20" viewBox="-64 0 512 512" width="20" xmlns="http://www.w3.org/2000/svg">
        <path fill="white" d="m336 512h-288c-26.453125 0-48-21.523438-48-48v-224c0-26.476562 21.546875-48 48-48h288c26.453125 0 48 21.523438 48 48v224c0 26.476562-21.546875 48-48 48zm-288-288c-8.8125 0-16 7.167969-16 16v224c0 8.832031 7.1875 16 16 16h288c8.8125 0 16-7.167969 16-16v-224c0-8.832031-7.1875-16-16-16zm0 0"></path>
        <path fill="white" d="m304 224c-8.832031 0-16-7.167969-16-16v-80c0-52.929688-43.070312-96-96-96s-96 43.070312-96 96v80c0 8.832031-7.167969 16-16 16s-16-7.167969-16-16v-80c0-70.59375 57.40625-128 128-128s128 57.40625 128 128v80c0 8.832031-7.167969 16-16 16zm0 0"></path>
      </svg>
      <input type="password" class="input" id="password" placeholder="Enter your Password" required>
    </div>

    <div class="flex-row">
      <div>
        <input type="checkbox" id="remember-me">
        <label>Remember me</label>
      </div>
      <a class="span" href="#">Forget password?</a>
    </div>

    <button type="submit" class="button-submit">Log in</button>
    <p class="p">Don't have an account? <a href="/signup/signup.html" class="span">Sign Up</a></p>
  </form>

  <script type="module">
    const loginForm = document.getElementById('login-form');
    
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Disable submit button to prevent double submission
      const submitButton = document.querySelector('.button-submit');
      submitButton.disabled = true;
      submitButton.textContent = 'Logging in...';
      
      try {
        console.log('Sending login request...');
        
        const response = await fetch('http://127.0.0.1:8000/api/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({
            email: document.getElementById('email').value,
            password: document.getElementById('password').value
          })
        });

        console.log('Response status:', response.status);
        console.log('Response headers:', response.headers);
        
        // Check if response is JSON before parsing
        const contentType = response.headers.get('content-type');
        let data;
        
        if (contentType && contentType.includes('application/json')) {
          data = await response.json();
          console.log('Response data:', data);
        } else {
          // Handle non-JSON responses (like HTML error pages)
          const textResponse = await response.text();
          console.error('Non-JSON response received:', textResponse);
          throw new Error(`Server returned non-JSON response. Status: ${response.status}`);
        }
        
        if (response.ok) {
          localStorage.setItem('token', data.access_token);
          localStorage.setItem('email', data.user.email);
          localStorage.setItem('isAdmin', data.user.is_admin);
          
          const successMessage = document.createElement('div');
          successMessage.textContent = 'Login successful';
          successMessage.className = 'success-message';
          document.body.appendChild(successMessage);

          setTimeout(() => {
            window.location.href = '/index.html';
          }, 2000);
        } else {
          throw new Error(data.detail || 'Login failed');
        }
      } catch (error) {
        console.error('Login error:', error);
        
        // Provide user-friendly error messages
        let errorMessage = 'Login failed. Please try again.';
        
        if (error.message.includes('fetch')) {
          errorMessage = 'Network error. Please check your connection.';
        } else if (error.message.includes('non-JSON')) {
          errorMessage = 'Server error. Please try again later.';
        } else if (error.message.includes('Invalid credentials')) {
          errorMessage = 'Invalid email or password.';
        }
        
        alert(errorMessage);
      } finally {
        // Re-enable submit button
        submitButton.disabled = false;
        submitButton.textContent = 'Log in';
      }
    });
  </script>

  <footer class="footer">
        <div class="ocutech">
          <img src="/images/logo.svg">
          <p class="footer-title"><span>OcuTech</span></p>
        </div>
        <div class="connect">
          <h2>Our Value</h2>
          <a href="/index.html#About_us">About us</a>
          <a href="/index.html#services">Service</a>
          <a href="/market.html#Contact">Contact</a>
        </div>
        <div class="social-icons">
          <h2>Follow us</h2>
            <a href="https://www.facebook.com/deltauniv/"><i class="fa-brands fa-facebook-f"></i><p>Facebook</p></a>
            <a href="https://www.instagram.com/deltauniversity?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw=="><i class="fa-brands fa-instagram"></i><p>Instagram</p></a>
            <a href="https://www.linkedin.com/school/delta-university-for-science-and-technology/"><i class="fa-brands fa-linkedin-in"></i><p>LinkedIn</p></a>
        </div>
        <div class="connect">
          <h2>Get Connect</h2>
          <p>(+20) 1017314060</p>
          <p>abdelrahman.naggar2005@gmail.com</p>
        </div>
      </footer>

  <script src="/component.js"></script>
  <script type="module" src="/auth-ui.js"></script>
</body>
</html>